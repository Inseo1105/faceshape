<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <link href="https://fonts.googleapis.com/css?family=Jua&display=swap" rel="stylesheet" />
        <link
            rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
            integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
            crossorigin="faceshap"
        />
        <!-- 폰트 -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Gamja+Flower&family=Jua&family=Nanum+Pen+Script&display=swap"
            rel="stylesheet"
        />

        <link rel="stylesheet" href="style.css" />
        <title>얼굴형 테스트/추천</title>
    </head>

    <body>
        <nav class="p-3 container navbar navbar-expand-lg navbar-light">
            <a class="navbar-brand" href="https://face-orzum.run.goorm.io/face/index.html"
                >얼굴형 테스트/추천</a
            >
        </nav>

        <section class="section">
            <h1 class="title">얼굴형 테스트</h1>
            <h2 class="subtitle">사진으로 얼굴형 찾고 액세서리 추천받기</h2>
        </section>

        <!-- 성별 -->
        <h3 class="gender-text pb-2 d-flex justify-content-center">성별을 선택하세요.</h3>
        <section class="d-flex justify-content-center">
            <p class="gender-yn d-flex align-items-center pr-3">여자</p>
            <div>
                <input type="checkbox" id="gender" />
                <label class="genderyn" for="gender">
                    <span class="knob"></span>
                </label>
            </div>
            <p class="gender-yn d-flex align-items-center pl-3">남자</p>
        </section>

        <!-- 이미지 등록 -->
        <script
            class="jsbin"
            src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"
        ></script>
        <div class="mt-3 container file-upload">
            <div class="image-upload-wrap">
                <input
                    class="file-upload-input"
                    type="file"
                    onchange="readURL(this);"
                    accept="image/*"
                />
                <div class="drag-text">
                    <img src="img/upload2.png" class="mt-5 pt-5 upload" />
                    <h3 class="mb-5 pb-5 pt-4 upload-text">
                        얼굴 사진을 등록해주세요~
                    </h3>
                </div>
            </div>

			
			<!-- 마우스 클릭 -->
                <div class="Move">
                    <div id="sun1" class="hide"><img src="imgS/roundS.png" class="testsize" /></div>
                    <div id="sun2" class="hide"><img src="imgS/catS.png" class="testsize" /></div>
                    <div id="sun3" class="hide"><img src="imgS/squareS.png" class="testsize" /></div>
                    <div id="sun4" class="hide"><img class="addtest" id="face-images" src="#" /></div>

                    <div id="gls1" class="hide"><img src="imgG/roundG.png" class="testsize" /></div>
                    <div id="gls2" class="hide"><img src="imgG/catG.png" class="testsize" /></div>
                    <div id="gls3" class="hide"><img src="imgG/squareG.png" class="testsize" /></div>
                    <div id="gls4" class="hide"><img class="addtest" id="face-images" src="#" /></div>
                </div>
			
			
			
            <div class="file-upload-content">
                <img class="file-upload-image" id="face-image" src="#" alt="your image" />
                <div id="loading" class="animated bounce">
                    <div class="spinner-border" role="status">
                        <span class="sr-only">Loading...</span>
                    </div>
                    <p class="text-center">얼굴형 분석중...</p>
                </div>
                <p class="result-message"></p>
                <div id="label-container" class="d-flex flex-column justify-content-around"></div>

				
				<!-- 선글라스 이미지 버튼들 -->
                <label class="menu w-btn-outline w-btn-green-outline" for="menu">선글라스</label>				
				<label class="menu2  w-btn-outline w-btn-green-outline" for="menu2">안경</label>
				
                <input id="menu" type="checkbox" name="menu12" onclick="checkonly(this)"/>
                <nav id="main_nav" class="pt-3 imgtest">
                    <div class="pt-3 labels">
                        <label class="labelradio">
                            <input
                                type="radio"
                                name="img_test"
                                value="sunglass1"
                                onclick="shows1();"
                            />
                            <div class="radio_btn">
                                <img src="imgS/roundS.png" />
                                <p>라운드</p>
                            </div></label
                        >
                        <label class="labelradio">
                            <input
                                type="radio"
                                name="img_test"
                                value="sunglass2"
                                onclick="shows2();"
                            />
                            <div class="radio_btn">
                                <img src="imgS/catS.png" />
                                <p>캣아이</p>
                            </div></label
                        >
                        <label class="labelradio">
                            <input
                                type="radio"
                                name="img_test"
                                value="sunglass3"
                                onclick="shows3();"
                            />
                            <div class="radio_btn">
                                <img src="imgS/squareS.png" />
                                <p>사각프레임</p>
                            </div></label
                        >
                    </div>
                    <div class="labels">
                        <label class="labelradio">
                            <input
                                class="file-upload-input2"
                                type="file"
                                onchange="readURL2(this);"
                                accept="image/*"
                            />
                            <div class="radio_btn">
                                <img src="img/add2.png" class="addimg" />
                                <p>추가하기</p>
                            </div></label
                        >
						<label class="labelradio">
                            <input
                               type="radio"
                                name="img_test"
                                value="addsun"
                                onclick="shows4();"
                            />
                            <div class="radio_btn">
                                <img src="img/new.png"  class="addimg" />
                                <p>추가한 선글라스</p>
                            </div></label
                        >
                        <label class="labelradio">
                            <input
                                type="radio"
                                name="img_test"
                                value="clears"
                                onclick="clears();"
                            />
                            <div class="radio_btn">
                                <img src="img/clear.png" />
                                <p>삭제</p>
                            </div></label
                        >
                    </div>
                </nav>
				
				<!-- 안경 이미지 버튼들 -->
                
                <input id="menu2" type="checkbox" name="menu12" onclick="checkonly(this)" />
                <nav id="main_nav2" class="pt-3 imgtest">
                    <div class="pt-3 labels">
                        <label class="labelradio">
                            <input
                                type="radio"
                                name="img_test"
                                value="glass1"
                                onclick="showg1();"
                            />
                            <div class="radio_btn">
                                <img src="imgG/roundG.png" />
                                <p>동그란</p>
                            </div></label
                        >
                        <label class="labelradio">
                            <input
                                type="radio"
                                name="img_test"
                                value="glass2"
                                onclick="showg2();"
                            />
                            <div class="radio_btn">
                                <img src="imgG/catG.png" />
                                <p>캣아이</p>
                            </div></label
                        >
                        <label class="labelradio">
                            <input
                                type="radio"
                                name="img_test"
                                value="glass3"
                                onclick="showg3();"
                            />
                            <div class="radio_btn">
                                <img src="imgG/squareG.png" />
                                <p>네모난</p>
                            </div></label
                        >
                    </div>
                    <div class="labels">
                        <label class="labelradio">
                            <input
                                class="file-upload-input2"
                                type="file"
                                onchange="readURL2(this);"
                                accept="image/*"
                            />
                            <div class="radio_btn">
                                <img src="img/add2.png" class="addimg" />
                                <p>추가하기</p>
                            </div></label
                        >
						<label class="labelradio">
                            <input
                               type="radio"
                                name="img_test"
                                value="addglass"
                                onclick="showg4();"
                            />
                            <div class="radio_btn">
                                <img src="img/new.png"  class="addimg" />
                                <p>추가한 안경</p>
                            </div></label
                        >
                        <label class="labelradio">
                            <input
                                type="radio"
                                name="img_test"
                                value="clearg"
                                onclick="clearg();"
                            />
                            <div class="radio_btn">
                                <img src="img/clear.png" />
                                <p>삭제</p>
                            </div></label
                        >
                    </div>
                </nav>

                <!-- 다른사진 재시도 -->
                <div class="pt-3 image-title-wrap">
                    <button
                        type="button p-2"
                        class="try-again-btn"
                        onclick="window.location.reload();"
                    >
                        <span class="try-again-text">다른 사진으로 재시도</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 맨아래 -->
        <footer class="footer pt-5 container d-flex justify-content-center">
            <div><p>2022 ksnu CIE졸업작품_김인서</p></div>
        </footer>

        <!--JavaScript-->

        <script>
                      <!-- 이미지 출력부분 -->
                               function readURL(input) {
                                   if (input.files && input.files[0]) {
                                       var reader = new FileReader();
                                       reader.onload = function (e) {
                                           $('.image-upload-wrap').hide();
                                           $('#loading').show();
                                           $('.file-upload-image').attr('src', e.target.result);
                                           $('.file-upload-content').show();
                                           $('.image-title').html(input.files[0].name);
                                       };
                                       reader.readAsDataURL(input.files[0]);
                                       init().then(function () {
                                           predict();
                                           $('#loading').hide();
                                       });
                                   } else {
                                       removeUpload();
                                   }
                               }
                      <!-- 다른 사진으로 재시도 -->
                               function removeUpload() {
                                   $('.file-upload-input').replaceWith($('.file-upload-input').clone());
                                   $('.file-upload-content').hide();
                                   $('.image-upload-wrap').show();
                               }
                               $('.image-upload-wrap').bind('dragover', function () {
                                   $('.image-upload-wrap').addClass('image-dropping');
                               });
                               $('.image-upload-wrap').bind('dragleave', function () {
                                   $('.image-upload-wrap').removeClass('image-dropping');
                               });
			<!-- 추가 이미지 -->
			function readURL2(input) {
				if (input.files && input.files[0]) {
					var reader = new FileReader();
					reader.onload = function(e) {					
						$('.addtest').attr('src', e.target.result);
					};
					reader.readAsDataURL(input.files[0]);
				} else {
					removeUpload();
				}
			}

                      <!-- 선글라스 이미지 -->
                      function shows1(){
                      	document.getElementById('sun1').style.display='block';
                      	document.getElementById('sun2').style.display='none';
                      	document.getElementById('sun3').style.display='none';
                      	document.getElementById('sun4').style.display='none';
                      }
                      function shows2(){
                      	document.getElementById('sun2').style.display='block';
                      	document.getElementById('sun1').style.display='none';;
                      	document.getElementById('sun3').style.display='none';
                      	document.getElementById('sun4').style.display='none';
                      }
                      function shows3(){
                      	document.getElementById('sun3').style.display='block';
                      	document.getElementById('sun1').style.display='none';
                      	document.getElementById('sun4').style.display='none';
                      }
                      function shows4(){
                      	document.getElementById('sun4').style.display='block';
                      	document.getElementById('sun1').style.display='none';
                      	document.getElementById('sun2').style.display='none';
                      	document.getElementById('sun3').style.display='none';
                      }
                      function clears(){
                      	document.getElementById('sun1').style.display='none';
                      	document.getElementById('sun2').style.display='none';
                      	document.getElementById('sun3').style.display='none';
                      	document.getElementById('sun4').style.display='none';
                      }
                      <!-- 안경 이미지 -->
                      function showg1(){
                      	document.getElementById('gls1').style.display='block';
                      	document.getElementById('gls2').style.display='none';
                      	document.getElementById('gls3').style.display='none';
                      	document.getElementById('gls4').style.display='none';
                      }
                      function showg2(){
                      	document.getElementById('gls2').style.display='block';
                      	document.getElementById('gls1').style.display='none';
                      	document.getElementById('gls3').style.display='none';
                      	document.getElementById('gls4').style.display='none';
                      }
                      function showg3(){
                      	document.getElementById('gls3').style.display='block';
                      	document.getElementById('gls1').style.display='none';
                      	document.getElementById('gls2').style.display='none';
                      	document.getElementById('gls4').style.display='none';
                      }
                      function showg4(){
                      	document.getElementById('gls4').style.display='block';
                      	document.getElementById('gls1').style.display='none';
                      	document.getElementById('gls2').style.display='none';
                      	document.getElementById('gls3').style.display='none';
                      }
                      function clearg(){
                      	document.getElementById('gls1').style.display='none';
                      	document.getElementById('gls2').style.display='none';
                      	document.getElementById('gls3').style.display='none';
                      	document.getElementById('gls4').style.display='none';
                      }
			
			
			
			
			<!-- 이미지 움직이기 마우스 드래그앤드롭 -->
			let imgs = document.getElementsByClassName("Move");
			for(var i in imgs){
				dragElement(imgs[i]);
			}
			function dragElement(elmnt) {
			  var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
				elmnt.onmousedown = dragMouseDown;
			  function dragMouseDown(e) {
				e = e || window.event;
				e.preventDefault();				
				pos3 = e.clientX;
				pos4 = e.clientY;
				document.onmouseup = closeDragElement;			
				document.onmousemove = elementDrag;
			  }
			  function elementDrag(e) {
				e = e || window.event;
				e.preventDefault();
				pos1 = pos3 - e.clientX;
				pos2 = pos4 - e.clientY;
				pos3 = e.clientX;
				pos4 = e.clientY;
				elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
				elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
			  }			
			  function closeDragElement(){
				  document.onmouseup = null;
				  document.onmousemove = null;
			  }
			}

			
		
    function checkonly(element) {
      const checkboxes 
          = document.getElementsByName("menu12");
      checkboxes.forEach((cb) => {
        cb.checked = false;
      })
      element.checked = true;
    }


			
			
			
        </script>

        <!-- Teachable Machine -->
        <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
        <script type="text/javascript">
                                let URL;
                                const urlMale = 'https://teachablemachine.withgoogle.com/models/nRYwMex6R/'; //남성
                                const urlFemale = 'https://teachablemachine.withgoogle.com/models/nRYwMex6R/'; //여성
                                let model, labelContainer, maxPredictions;
                                async function init() {
                                    if (document.getElementById('gender').checked) {
                                        URL = urlMale;
                                    } else {
                                        URL = urlFemale;
                                    }
                                    const modelURL = URL + 'model.json';
                                    const metadataURL = URL + 'metadata.json';
                                    model = await tmImage.load(modelURL, metadataURL);
                                    maxPredictions = model.getTotalClasses();
                                    labelContainer = document.getElementById('label-container');
                                    for (let i = 0; i < maxPredictions; i++) {
                                        var element = document.createElement('div');
                                        element.classList.add('d-flex');
                                        labelContainer.appendChild(element);
                                    }
                                }

								
			
			
                                async function predict() {
                                    var image = document.getElementById('face-image');
                                    const prediction = await model.predict(image, false);
                        			//높은 순서대로 결과값 출력
                                    prediction.sort((a, b) => parseFloat(b.probability) - parseFloat(a.probability));
                                    console.log(prediction[0].className);
                                    var resultTitle, resultExplain, resultCeleb, resultSun;
                                    if (document.getElementById('gender').checked) {
                                        switch (prediction[0].className) {
                                           case 'egg':
                                             resultTitle = '달걀형';
                                                resultExplain =
                                                    '전체적인 모양이 계란 모양에 가깝습니다. 순수하고 인형같은 느낌을 주며 전형적인 미인상의 얼굴형입니다.';
                                                resultCeleb =
                                                    '#달걀형';
												resultSun =
													'테스트 중입니다.';
                                                break;
                                            case 'round':
                                                resultTitle = '동그란형';
                                                resultExplain =
                                                    '가로 너비가 넓은 것이 특징입니다. 광대와 턱이 발달되지 않아 어린느낌을 주어 귀엽고 어려보이는 이미지 입니다.';
                        						resultCeleb =
                                                    '#동그란형';
												resultSun =
													'테스트 중입니다.';
                                                break;
                                            case 'long':
                                                resultTitle = '긴얼굴형';
                                                resultExplain =
                                                    '광대와 턱 골격이 모두 없고 세로로 긴 얼굴형입니다. 긴 얼굴형은 성숙해 보이는 느낌을 줍니다.';
                        						resultCeleb =
                                                    '#긴얼굴형';
												resultSun =
													'테스트 중입니다.';
                                                break;
                                            case 'angled':
                                               resultTitle = '각진형';
                                                resultExplain =
                                                   '광대가 거의 부각되지 않으며 턱이 발달된 유형으로 고급스러운 진중한 느낌을 주는 얼굴형입니다.';
                        						resultCeleb =
                                                    '#각진형';
												resultSun =
													'테스트 중입니다.';
                                                break;
                                            case 'heart':
                                                resultTitle = '하트형';
                                                resultExplain =
                                                    '광대가 발달되어 있으며 얼굴길이가 짧습니다. 사랑스럽고 생기가 넘치는 느낌을 줍니다.'
                        						resultCeleb =
                                                    '#하트형';
												resultSun =
													'테스트 중입니다.';
                                                break;
                                            default:
                                                resultTitle = '알수없음';
                                                resultExplain = '';
                                                resultCeleb = '';
                                        }
                                    } else {
                                        switch (prediction[0].className) {
                                            case 'egg':
                                             resultTitle = '달걀형';
                                                resultExplain =
                                                    '전체적인 모양이 계란 모양에 가깝습니다. 순수하고 인형같은 느낌을 주며 전형적인 미인상의 얼굴형입니다.';
                                                resultCeleb =
                                                    '#달걀형';
												resultSun =
													'테스트 중입니다.';
                                                break;
                                            case 'round':
                                                resultTitle = '동그란형';
                                                resultExplain =
                                                    '가로 너비가 넓은 것이 특징입니다. 광대와 턱이 발달되지 않아 어린느낌을 주어 귀엽고 어려보이는 이미지 입니다.';
                        						resultCeleb =
                                                    '#동그란형';
												resultSun =
													'테스트 중입니다.';
                                                break;
                                            case 'long':
                                                resultTitle = '긴얼굴형';
                                                resultExplain =
                                                    '광대와 턱 골격이 모두 없고 세로로 긴 얼굴형입니다. 긴 얼굴형은 성숙해 보이는 느낌을 줍니다.';
                        						resultCeleb =
                                                    "<a href='https://search.shopping.naver.com/search/all?where=all&frm=NVSCTAB&query=오버사이즈선글라스' target='_blank'>#오버사이즈</a>";
												resultSun =
													'테스트 중입니다.';
                                                break;
                                            case 'angled':
                                               resultTitle = '각진형';
                                                resultExplain =
                                                   '광대가 거의 부각되지 않으며 턱이 발달된 유형으로 고급스러운 진중한 느낌을 주는 얼굴형입니다.';
                        						resultCeleb =
                                                    '#각진형';
												resultSun =
													'테스트 중입니다.';
                                                break;
                                            case 'heart':
                                                resultTitle = '하트형';
                                                resultExplain =
                                                    '광대가 발달되어 있으며 얼굴길이가 짧습니다. 사랑스럽고 생기가 넘치는 느낌을 줍니다.'
                        						resultCeleb =
                                                    '#하트형';
												resultSun =
													'테스트 중입니다.';
                                                break;
                                            default:
                                                resultTitle = '알수없음';
                                                resultExplain = '';
                                                resultCeleb = '';
                                        }
                                    }
                                    var title =
                                        "<div class='" +
                                        prediction[0].className +
                                        "-face-title'>" +
                                        resultTitle +
                                        '</div>';
                                    var explain = "<div class='face-explain pt-2'>" + resultExplain + '</div>';
                                    var celeb =
                                        "<div class='" +
                                        prediction[0].className +
                                        "-face-celeb pt-2 pb-2'>" +
                                        resultCeleb +
                                        '</div>';
									 var Sun = "<div class='face-explain pt-2'>" + resultSun + '</div>';

                        <!-- 설명/퍼센트 사이 -->
                       
									
            <!--글자 링크 "<a href='https://blog.naver.com/3pmarketer/222735730736' target='_blank'>#aaaa</a>"; -->


                        <!-- 퍼센트 -->
                                    var barWidth;
                                    for (let i = 0; i < maxPredictions; i++) {
                                        if (prediction[i].probability.toFixed(2) > 0.1) {
                                            barWidth = Math.round(prediction[i].probability.toFixed(2) * 100) + '%';
                                        } else if (prediction[i].probability.toFixed(2) >= 0.01) {
                                            barWidth = '4%';
                                        } else {
                                            barWidth = '2%';
                                        }
                                        var labelTitle;
                                        switch (prediction[i].className) {
                                            case 'egg':
                                                labelTitle = '달걀형';
                                                break;
                                            case 'heart':
                                                labelTitle = '하트형';
                                                break;
                                            case 'long':
                                                labelTitle = '긴얼굴형';
                                                break;
                                            case 'round':
                                                labelTitle = '동그란형';
                        						break;
                                            case 'angled':
                                                labelTitle = '각진형';
                                                break;
                                            default:
                                                labelTitle = '알수없음';
                                        }
                                        var label =
                                            "<div class='face-label d-flex align-items-center'>" +
                                            labelTitle +
                                            '</div>';
                                        var bar =
                                            "<div class='bar-container position-relative container'><div class='" +
                                            prediction[i].className +
                                            "-box'></div><div class='d-flex justify-content-center align-items-center " +
                                            prediction[i].className +
                                            "-bar' style='width: " +
                                            barWidth +
                                            "'><span class='d-block percent-text'>" +
                                            Math.round(prediction[i].probability.toFixed(2) * 100) +
                                            '%</span></div></div>';

										labelContainer.childNodes[i].innerHTML = label + bar
										
								
										
										
										
            								
                                    }
            							<!-- 화면 출력 소스 -->
									$('.result-message').html(title + explain + celeb);								
            															
                                }
			
        </script>
    </body>
</html>